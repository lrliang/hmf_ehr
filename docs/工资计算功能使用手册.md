# 工资计算功能使用手册

## 1. 功能概述

### 1.1 功能介绍
工资计算系统是基于员工基础薪资和月度考勤报告数据，自动计算员工月度工资的智能化系统。系统严格按照劳动法规定的工资计算标准，确保计算结果的准确性和合规性。

### 1.2 主要特性
- **自动化计算**: 基于确认的考勤数据自动计算工资
- **标准化算法**: 遵循21.75天标准工时制计算规则
- **多重加班费**: 支持休息日、法定节假日、延时加班费计算
- **状态管理**: 草稿→计算→确认→发放的完整流程控制
- **批量处理**: 支持单月或多月批量工资计算
- **审计追溯**: 完整的计算快照和操作日志记录

## 2. 计算规则说明

### 2.1 基础计算公式
```
日工资 = 员工月标准工资 ÷ 21.75天
小时工资 = 日工资 ÷ 8小时
```

### 2.2 出勤工资计算
```
出勤比例 = 实际出勤天数 ÷ 应出勤天数
正常出勤工资 = 月标准工资 × 出勤比例
```

### 2.3 扣款计算
```
事假扣款 = 日工资 × 事假天数
```

### 2.4 加班费计算
```
休息日加班费 = 日工资 × 200% × (休息日加班小时数 ÷ 8)
法定节假日加班费 = 日工资 × 300% × (法定节假日加班小时数 ÷ 8)
延时加班费 = 小时工资 × 150% × 延时加班小时数
```

### 2.5 最终工资计算
```
考勤工资 = 正常出勤工资 - 事假扣款 + 各类加班费
应发工资 = 考勤工资 + 补助/奖金
实发工资 = 应发工资 - 社保 - 公积金 - 个税 - 伙食费 - 其他扣款
```

## 3. 操作指南

### 3.1 访问工资管理
1. 登录系统后，点击左侧导航菜单中的"薪酬管理"
2. 选择"工资详情"进入工资管理页面

### 3.2 工资计算操作

#### 3.2.1 单月工资计算
1. 点击"工资计算"按钮
2. 选择要计算的月份（YYYY-MM格式）
3. 可选择特定员工或计算所有员工
4. 是否强制重新计算已存在的记录
5. 点击"开始计算"执行计算

#### 3.2.2 批量多月计算
1. 点击"批量计算"按钮
2. 选择多个要计算的月份
3. 设置员工范围（可选）
4. 选择是否强制重新计算
5. 点击"批量计算"开始处理

### 3.3 工资详情管理

#### 3.3.1 查看工资详情
1. 在工资详情列表中浏览所有记录
2. 支持按员工工号、姓名、月份等条件筛选
3. 点击具体记录查看详细的计算明细
4. 查看计算快照了解计算过程

#### 3.3.2 确认工资详情
1. 选择状态为"已计算"的工资记录
2. 点击"确认"按钮
3. 确认后状态变更为"已确认"，不可再修改
4. 系统记录确认时间和确认人信息

#### 3.3.3 标记工资发放
1. 选择状态为"已确认"的工资记录
2. 点击"标记发放"按钮
3. 确认发放操作后状态变更为"已发放"
4. 系统记录发放时间和发放人信息

### 3.4 工资统计分析
1. 选择"统计分析"菜单
2. 选择要查看的月份
3. 查看月度工资统计信息：
   - 总员工数、总应发工资、总实发工资
   - 各状态工资记录分布
   - 社保、公积金、个税统计

## 4. 数据来源说明

### 4.1 员工基础数据
- **月标准工资**: 从员工档案中的baseSalary字段获取
- **员工状态**: 只计算状态为"active"的员工
- **员工信息**: 工号、姓名等基础信息

### 4.2 考勤数据来源
- **数据表**: attendance_monthly_reports（月度考勤报告）
- **状态要求**: 考勤报告必须为"已确认"状态
- **主要数据**:
  - 应出勤天数、实出勤天数
  - 各类假期天数（事假、年假、病假等）
  - 加班时间统计（休息日、法定节假日加班）
  - 补助奖金（出差补贴、值班补贴等）

### 4.3 计算前置条件
1. 员工必须有有效的基础薪资设置
2. 对应月份必须有已确认的考勤月报
3. 考勤月报数据完整且状态为CONFIRMED

## 5. 状态说明

### 5.1 工资状态定义
- **DRAFT**: 草稿状态，可以修改和删除
- **CALCULATED**: 已计算状态，等待确认
- **CONFIRMED**: 已确认状态，不允许修改
- **PAID**: 已发放状态，完成整个流程
- **CANCELLED**: 已取消状态

### 5.2 状态流转规则
```
DRAFT → CALCULATED → CONFIRMED → PAID
  ↑         ↓            ↓
  └─── CANCELLED ←──────┘
```

### 5.3 权限控制
- **HR管理员**: 可执行工资计算、确认工资详情
- **财务人员**: 可标记工资发放状态
- **普通员工**: 只能查看自己的工资详情
- **系统管理员**: 拥有所有操作权限

## 6. 注意事项

### 6.1 计算注意事项
1. **数据依赖**: 工资计算依赖已确认的考勤月报，请确保考勤数据准确
2. **重复计算**: 系统默认不会重复计算已存在的工资记录，除非选择"强制重新计算"
3. **数据完整性**: 如果员工缺少基础薪资或考勤数据，将跳过计算并记录错误信息

### 6.2 状态管理注意事项
1. **确认操作**: 工资确认后无法修改，请仔细核对数据后再确认
2. **发放标记**: 标记发放是财务流程的一部分，请确保实际发放后再操作
3. **取消操作**: 取消状态的工资记录可以重新计算

### 6.3 数据安全注意事项
1. **操作日志**: 系统记录所有工资相关操作，便于审计追溯
2. **计算快照**: 保存完整的计算过程数据，支持问题排查
3. **权限控制**: 严格控制工资数据的访问和操作权限

## 7. 常见问题

### 7.1 计算问题
**Q: 为什么某个员工的工资没有计算？**
A: 请检查：
- 员工状态是否为"active"
- 是否设置了基础薪资(baseSalary)
- 对应月份是否有已确认的考勤月报

**Q: 加班费计算不正确怎么办？**
A: 请检查：
- 考勤月报中的加班时间数据是否准确
- 确认加班类型分类正确（休息日/法定节假日）
- 查看计算快照了解详细计算过程

### 7.2 操作问题
**Q: 工资确认后发现错误怎么处理？**
A: 已确认的工资记录无法直接修改，建议：
- 联系管理员取消该记录
- 修正考勤数据后重新计算
- 或通过其他扣款方式在下月调整

**Q: 批量计算时部分员工失败怎么办？**
A: 系统会提供详细的错误报告，请：
- 查看错误摘要了解失败原因
- 修正对应的数据问题
- 对失败的员工单独重新计算

### 7.3 数据问题
**Q: 如何查看工资计算的详细过程？**
A: 可以通过以下方式：
- 查看工资详情中的计算快照
- 检查操作日志记录
- 对比考勤数据和计算结果

## 8. 联系支持

如果在使用过程中遇到技术问题或需要功能改进建议，请联系：
- **技术支持**: 系统管理员
- **业务咨询**: HR部门
- **功能建议**: 通过系统反馈功能提交

---

**文档版本**: v1.0
**更新时间**: 2024年12月
**适用版本**: HR管理系统 v1.3+
