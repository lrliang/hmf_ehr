# HMF EHR ç³»ç»Ÿç«¯å£é…ç½®è¯´æ˜

## ğŸ“‹ ç«¯å£åˆ†é…æ€»è§ˆ

ä¸ºäº†æ”¯æŒå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¹¶è¡Œè¿è¡Œï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸åŒçš„ç«¯å£åˆ†é…ç­–ç•¥ã€‚

## ğŸ­ ç”Ÿäº§ç¯å¢ƒç«¯å£

| æœåŠ¡åç§° | å®¹å™¨åç§° | å†…éƒ¨ç«¯å£ | å¤–éƒ¨ç«¯å£ | è®¿é—®åœ°å€ | è¯´æ˜ |
|----------|----------|----------|----------|----------|------|
| Nginx | hmf_ehr_nginx | 80, 443 | 80, 443 | http://localhost | ç»Ÿä¸€å…¥å£ |
| Frontend | hmf_ehr_frontend | 80 | - | - | é€šè¿‡Nginxä»£ç† |
| Backend | hmf_ehr_backend | 8080 | 8080 | http://localhost:8080 | APIæœåŠ¡ |
| PostgreSQL | hmf_ehr_postgres | 5432 | 5432 | localhost:5432 | æ•°æ®åº“ |
| Redis | hmf_ehr_redis | 6379 | 6379 | localhost:6379 | ç¼“å­˜ |

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒç«¯å£

| æœåŠ¡åç§° | å®¹å™¨åç§° | å†…éƒ¨ç«¯å£ | å¤–éƒ¨ç«¯å£ | è®¿é—®åœ°å€ | è¯´æ˜ |
|----------|----------|----------|----------|----------|------|
| Nginx-Dev | hmf_ehr_nginx_dev | 80 | 8090 | http://localhost:8090 | å¼€å‘ä»£ç† |
| Frontend-Dev | hmf_ehr_frontend_dev | 3000 | 3001 | http://localhost:3001 | Reactå¼€å‘æœåŠ¡å™¨ |
| Backend-Dev | hmf_ehr_backend_dev | 8080 | 8081 | http://localhost:8081 | NestJSå¼€å‘æœåŠ¡å™¨ |
| Backend-Debug | hmf_ehr_backend_dev | 9229 | 9230 | - | Node.jsè°ƒè¯•ç«¯å£ |
| PostgreSQL-Dev | hmf_ehr_postgres_dev | 5432 | 5433 | localhost:5433 | å¼€å‘æ•°æ®åº“ |
| Redis-Dev | hmf_ehr_redis_dev | 6379 | 6380 | localhost:6380 | å¼€å‘ç¼“å­˜ |

## ğŸ”„ è®¿é—®æ–¹å¼å¯¹æ¯”

### ç”Ÿäº§ç¯å¢ƒè®¿é—®
```bash
# å‰ç«¯åº”ç”¨
curl http://localhost

# APIæ¥å£
curl http://localhost/api/v1/health

# APIæ–‡æ¡£
open http://localhost/api/v1/docs

# ç›´è¿æ•°æ®åº“
psql -h localhost -p 5432 -U postgres -d hmf_ehr

# ç›´è¿Redis
redis-cli -h localhost -p 6379
```

### å¼€å‘ç¯å¢ƒè®¿é—®
```bash
# å‰ç«¯åº”ç”¨ (ç›´è¿)
curl http://localhost:3001

# å‰ç«¯åº”ç”¨ (é€šè¿‡Nginx)
curl http://localhost:8090

# APIæ¥å£ (ç›´è¿)
curl http://localhost:8081/api/v1/health

# APIæ¥å£ (é€šè¿‡Nginx)
curl http://localhost:8090/api/v1/health

# APIæ–‡æ¡£
open http://localhost:8081/api/v1/docs

# ç›´è¿å¼€å‘æ•°æ®åº“
psql -h localhost -p 5433 -U postgres -d hmf_ehr_dev

# ç›´è¿å¼€å‘Redis
redis-cli -h localhost -p 6380
```

## ğŸ”§ ç«¯å£å†²çªè§£å†³

### å¸¸è§ç«¯å£å†²çª
å¦‚æœé‡åˆ°ç«¯å£å ç”¨é—®é¢˜ï¼Œå¯ä»¥æ£€æŸ¥å’Œå¤„ç†ï¼š

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :80
lsof -i :3001
lsof -i :5432
lsof -i :5433

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>

# æˆ–è€…ä¿®æ”¹docker-composeæ–‡ä»¶ä¸­çš„ç«¯å£æ˜ å°„
```

### è‡ªå®šä¹‰ç«¯å£é…ç½®
å¦‚éœ€ä¿®æ”¹ç«¯å£ï¼Œè¯·ç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **ç”Ÿäº§ç¯å¢ƒ**: `docker-compose.yml`
2. **å¼€å‘ç¯å¢ƒ**: `docker-compose.dev.yml`
3. **Nginxé…ç½®**: `nginx/conf.d/default.conf` å’Œ `nginx/conf.d/dev.conf`

## ğŸŒ ç½‘ç»œé…ç½®

### ç”Ÿäº§ç¯å¢ƒç½‘ç»œ
- ç½‘ç»œåç§°: `hmf_ehr_network`
- å­ç½‘: `172.20.0.0/16`
- é©±åŠ¨: bridge

### å¼€å‘ç¯å¢ƒç½‘ç»œ
- ç½‘ç»œåç§°: `hmf_ehr_dev_network`
- é©±åŠ¨: bridge

## ğŸš€ å¯åŠ¨å‘½ä»¤

### å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
```bash
./scripts/start.sh prod
# æˆ–
./scripts/start.sh
```

### å¯åŠ¨å¼€å‘ç¯å¢ƒ
```bash
./scripts/start.sh dev
```

### åŒæ—¶è¿è¡Œä¸¤ä¸ªç¯å¢ƒ
```bash
# ç»ˆç«¯1: å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
./scripts/start.sh prod

# ç»ˆç«¯2: å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/start.sh dev
```

## ğŸ“Š æœåŠ¡å¥åº·æ£€æŸ¥

### ç”Ÿäº§ç¯å¢ƒå¥åº·æ£€æŸ¥
```bash
# ç³»ç»Ÿå¥åº·
curl http://localhost/health

# NginxçŠ¶æ€
curl http://localhost/nginx_status

# åç«¯å¥åº·
curl http://localhost/api/v1/health
```

### å¼€å‘ç¯å¢ƒå¥åº·æ£€æŸ¥
```bash
# å¼€å‘ç¯å¢ƒå¥åº·
curl http://localhost:8090/dev-health

# å‰ç«¯å¥åº·
curl http://localhost:3001

# åç«¯å¥åº·
curl http://localhost:8081/api/v1/health
```

## ğŸ”’ é˜²ç«å¢™é…ç½®

å¦‚æœä½¿ç”¨é˜²ç«å¢™ï¼Œéœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š

### ç”Ÿäº§ç¯å¢ƒç«¯å£
```bash
# HTTP/HTTPS
sudo ufw allow 80
sudo ufw allow 443

# æ•°æ®åº“ (å¦‚éœ€å¤–éƒ¨è¿æ¥)
sudo ufw allow 5432

# Redis (å¦‚éœ€å¤–éƒ¨è¿æ¥)
sudo ufw allow 6379
```

### å¼€å‘ç¯å¢ƒç«¯å£
```bash
# å¼€å‘æœåŠ¡ç«¯å£
sudo ufw allow 3001
sudo ufw allow 8081
sudo ufw allow 8090

# å¼€å‘æ•°æ®åº“
sudo ufw allow 5433

# å¼€å‘Redis
sudo ufw allow 6380

# è°ƒè¯•ç«¯å£
sudo ufw allow 9230
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**: ç¡®ä¿æ‰€é€‰ç«¯å£æœªè¢«å…¶ä»–æœåŠ¡å ç”¨
2. **é˜²ç«å¢™**: æ ¹æ®éœ€è¦å¼€æ”¾ç›¸åº”ç«¯å£
3. **æ•°æ®éš”ç¦»**: å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ•°æ®åº“
4. **é…ç½®åŒæ­¥**: ä¿®æ”¹ç«¯å£åéœ€è¦åŒæ­¥æ›´æ–°ç›¸å…³é…ç½®æ–‡ä»¶
5. **SSLè¯ä¹¦**: ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®çœŸå®SSLè¯ä¹¦
6. **ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

## ğŸ†˜ æ•…éšœæ’é™¤

### ç«¯å£å ç”¨é—®é¢˜
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep :80

# å¼ºåˆ¶åœæ­¢æœåŠ¡
docker-compose down --remove-orphans
```

### ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥Dockerç½‘ç»œ
docker network ls

# é‡å»ºç½‘ç»œ
docker-compose down
docker network prune
docker-compose up -d
```

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs [service_name]

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart [service_name]
```
